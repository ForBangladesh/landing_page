name: ğŸš€ Tohol App Landing [DevOps]

on:
  push:
    branches:
      - devops

jobs:
  app_deployment:
    name: ğŸ‰ Deployment
    runs-on: ubuntu-latest
    steps:
      - name: ğŸšš Install SSH Key
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          known_hosts: 'app_deployment'

  on_success:
    name: âš¡ï¸ Send Telegram Message on Success
    needs: app_deployment
    if: ${{ success() }}
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Message on Success
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d message_thread_id=${{ secrets.TELEGRAM_THREAD_ID }} \
            -d text="
            âœ… New version released for toholapp.com ğŸ‰
            ----------------------
            ğŸ‘· New commit by ${{ github.actor }}!
            ğŸš© Commit: ${{ github.event.head_commit.message }}
            ğŸŒ Repository: ${{ github.repository }}"
            ğŸ”– Branch: ${{ github.ref_name }}" \
            -d parse_mode="Markdown"
  
  on_failure:
    name: âš¡ï¸ Send Telegram Message on Failure
    needs: app_deployment
    if: ${{ failure() }}
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Message on Failure
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d message_thread_id=${{ secrets.TELEGRAM_THREAD_ID }} \
            -d text="
            âŒ New version released failed for toholapp.com ğŸ‰
            ----------------------
            ğŸ‘· New commit by ${{ github.actor }}!
            ğŸš© Commit: ${{ github.event.head_commit.message }}
            ğŸŒ Repository: ${{ github.repository }}"
            ğŸ”– Branch: ${{ github.ref_name }}" \
            -d parse_mode="Markdown"
